flowchart TD
  W[World Layer  external info zones inventory tariffs]
  SO[Sensors Outside  outdoor climate and boundary]
  SI[Sensors Inside  indoor climate flows power occupancy]
  P[Processing  ETL cleaning features]
  C[Cognition Review  rules human AI review required]
  D[Data Plane  all databases tables T1 to Tx]
  A[Actuation  HA devices pumps valves EV charger]

  W --> SO --> SI --> P --> C --> A
  P --> D
  A --> D
  D --> C

  subgraph SharedServices [Shared Services]
    T[(Time Service)]
    S[(Safety Interlocks)]
    I[(Inventory Identity Location)]
  end

  T --- W
  T --- P
  T --- C
  T --- A

  S -.-> C
  S -.-> A

  I --- W
  I --- SO
  I --- SI

  subgraph Hist [History Stream]
    H[(Append only logs and versions)]
  end

  H --- P
  H --- C
  H --- A
