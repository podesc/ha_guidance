flowchart TD
  W[World Layer  weather tariffs zones inventory]
  SO[Sensors Outside  external climate and boundary sensors]
  SI[Sensors Inside  room temps humidity flow return power]
  P[Processing Layer  ETL cleaning feature building]
  C[Cognition Review Layer  rules human input AI input review required]
  D[Data Layer  Data Plane tables T1 to Tx across all databases]
  A[Actuation Layer  HA pumps valves EV charger]

  W --> SO --> SI --> P --> C --> A
  P --> D
  A --> D
  D --> C

  subgraph Services [Shared Services]
    T[(Time Service)]
    S[(Safety Interlocks)]
    I[(Inventory Identity Location Service)]
  end

  T --- W
  T --- P
  T --- C
  T --- A

  S -.-> C
  S -.-> A

  I --- W
  I --- SO
  I --- SI

  subgraph History [History Stream]
    H[(Append only logs  events configs experiments)]
  end

  H --- P
  H --- C
  H --- A
